<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1, minimum-scale=1.0, maximum-scale=8.0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

	<title>redditFunFetcher</title>
	<link href="media/style.css" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="media/swipeview.js"></script>
</head>

<body>
	<div id="wrapper"></div>
	
<script type="text/javascript">


var	gallery,
	el,
	i,
	page,
	slides = [

{% for s in subs %}
		{
			img: "image/{{ s.key }}",
                        width: {{ s.width }},
                        height: {{ s.height }},
			desc: "{{ s.title }}"
		},
{% endfor %}
	];

gallery = new SwipeView('#wrapper', { numberOfPages: slides.length });

// Load initial data
for (i=0; i<3; i++) {
	page = i==0 ? slides.length-1 : i-1;
	el = document.createElement('img');
	el.className = 'loading';
	el.src = slides[page].img;
	el.width =  slides[page].width * (gallery.wrapperWidth / slides[page].width / 
	       ( 1024 / slides[page].width ) );
	el.height = slides[page].height * (gallery.wrapperHeight /  slides[page].height / 
	       ( 768 / slides[page].height )) ;

	el.onload = function () { this.className = ''; }
	gallery.masterPages[i].appendChild(el);

	el = document.createElement('span');
	el.innerHTML = slides[page].desc;
	gallery.masterPages[i].appendChild(el)
}

gallery.onFlip(function () {
	var el,
		upcoming,
		i;

	for (i=0; i<3; i++) {
		upcoming = gallery.masterPages[i].dataset.upcomingPageIndex;

		if (upcoming != gallery.masterPages[i].dataset.pageIndex) {
		       el = gallery.masterPages[i].querySelector('img');
		       el.className = 'loading';
		       el.src = slides[upcoming].img;
		       
		       

		       el.width =  slides[upcoming].width * ( gallery.wrapperWidth /  slides[upcoming].width) / 
		       (1024 / slides[upcoming].width) ;
			el.height = slides[upcoming].height * (  gallery.wrapperHeight /  slides[upcoming].height ) / 
		       (768 /  slides[upcoming].height);
			
			el = gallery.masterPages[i].querySelector('span');
			el.innerHTML = slides[upcoming].desc;
		}
	}
	
});

gallery.onMoveOut(function () {
	gallery.masterPages[gallery.currentMasterPage].className = gallery.masterPages[gallery.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/, '');
});

gallery.onMoveIn(function () {
	var className = gallery.masterPages[gallery.currentMasterPage].className;
	/(^|\s)swipeview-active(\s|$)/.test(className) || (gallery.masterPages[gallery.currentMasterPage].className = !className ? 'swipeview-active' : className + ' swipeview-active');
});

</script>
</body>
</html>
